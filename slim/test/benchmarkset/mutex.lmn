% mutex.lmn
%     2009.05.26  gocho
%
% Simple Mutex model
%

% np(13) -> mutex_p13.il
% np(14) -> mutex_p14.il
% np(15) -> mutex_p15.il
% np(16) -> mutex_p16.il
% np(17) -> mutex_p17.il

% property0: クリティカルセクションにプロセスが2以上入ることはない
% property1: rqstを出したら, いつかクリティカルセクションに入れる
%            ※他のプロセスがrquest->get_mtx->release->request...するエラーサイクルがある
% property2: Strong Fairness -> property1
%            閉路中のrequestにFairnessを施行する

proc_generator{
  np(3).
  init @@
    np(N) :- N>0, M=N-1 |
    np(M), p(wait,N).
}.
init_end @@
  proc_generator{np(0), $p,@p}/ :- $p.

mutex.

request @@
  X=wait :-
  X=rqst.
get_mtx @@
  X=rqst, mutex :-
  X=crit.
release @@
  X=crit :-
  X=wait, mutex .