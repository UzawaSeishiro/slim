% rrobin.lmn
%    2009.06.10  gocho
%
% Mutual Exclusion Algorithm
%  Process Scheduling by Round-Robin
%

% n(7)  -> rrobin_n7.il
% n(8)  -> rrobin_n8.il
% n(9)  -> rrobin_n9.il
% n(10) -> rrobin_n10.il
% n(11) -> rrobin_n11.il

% property0: クリティカルセクションに入れるプロセスは常に1つ(以下)である
% property1: クリティカルセクションにいないプロセスは, 必ずいつかクリティカルセクションに入れる
% property2: Strong Fairness -> property1

init{
  n(3).
  init_ @@ n(N) :- N>0, N2=N-1 | 
           n(N2), p{cid(N2), mode=wait}.
}.
iEnd_ @@ init{$i,@i, n(0)}/ :- $i, queue=[tail].

rqst_ @@ % 並ぶ
  p{$p, mode=wait},      F=[    tail |[]]  :- \+($p=($q, '+'(L))) |
  p{$p, mode=rqst, +L1}, F=[L1, tail |[]].
enter @@ % 入る
  p{$p, mode=rqst, +L1}, queue=[L1 |F] :-
  p{$p, mode=crit, +L1}, queue=[L1 |F].
exit_ @@ % 出る
  p{$p, mode=crit, +L1}, queue=[L1 |F] :-
  p{$p, mode=wait},      queue=F.